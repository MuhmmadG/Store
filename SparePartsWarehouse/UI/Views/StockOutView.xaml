<UserControl x:Class="SparePartsWarehouse.UI.Views.StockOutView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
     
        FlowDirection="RightToLeft">

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ================= بيانات الصرف ================= -->
        <GroupBox Header="بيانات الصرف" Margin="0,0,0,15">
            <Grid Margin="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- القسم -->
                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,15,10">
                    <TextBlock Text="القسم (إلى)" FontWeight="SemiBold"/>
                    <ComboBox Height="30"
                              ItemsSource="{Binding FactorySelector.FactoryDepartments}"
                              SelectedItem="{Binding FactorySelector.SelectedFactoryDepartment}"
                              DisplayMemberPath="Name"/>
                </StackPanel>

                <!-- الماكينة -->
                <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,0,10">
                    <TextBlock Text="الماكينة" FontWeight="SemiBold"/>
                    <ComboBox Height="30"
                              ItemsSource="{Binding FactorySelector.Machines}"
                              SelectedItem="{Binding FactorySelector.SelectedMachine}"
                              DisplayMemberPath="MachineName"/>
                </StackPanel>

                <!-- التاريخ -->
                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,15,0">
                    <TextBlock Text="تاريخ الصرف" FontWeight="SemiBold"/>
                    <DatePicker Height="30"
                                SelectedDate="{Binding Date, Mode=TwoWay}"
                                SelectedDateFormat="Short"/>
                </StackPanel>

                <!-- المستلم -->
                <StackPanel Grid.Row="1" Grid.Column="1">
                    <TextBlock Text="اسم المستلم" FontWeight="SemiBold"/>
                    <TextBox Height="30"
                             Text="{Binding ReceiverName,
                                    UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- ================= إضافة صنف ================= -->
        <GroupBox Header="إضافة صنف" Grid.Row="1" Margin="0,0,0,15">
            <Grid Margin="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="140"/>
                </Grid.ColumnDefinitions>

                <!-- الصف الأول -->
                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,10,10">
                    <TextBlock Text="القسم"/>
                    <ComboBox Height="30"
                              ItemsSource="{Binding ItemSelector.StoreDepartments}"
                              SelectedItem="{Binding ItemSelector.SelectedStoreDepartment}"
                              DisplayMemberPath="Name"/>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,10,10">
                    <TextBlock Text="الفئة"/>
                    <ComboBox Height="30"
                              ItemsSource="{Binding ItemSelector.Categories}"
                              SelectedItem="{Binding ItemSelector.SelectedCategory}"
                              DisplayMemberPath="Name"/>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,0,10,10">
                    <TextBlock Text="الصنف"/>
                    <ComboBox Height="30"
                              ItemsSource="{Binding ItemSelector.Items}"
                              SelectedItem="{Binding ItemSelector.SelectedItem}"
                              DisplayMemberPath="ItemName"/>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="3" Margin="0,0,10,10">
                    <TextBlock Text="الوصف"/>
                    <ComboBox Height="30"
                              ItemsSource="{Binding ItemSelector.ItemDescriptions}"
                              SelectedItem="{Binding ItemSelector.SelectedItemDescription}"
                              DisplayMemberPath="ItemCode"
                              IsEditable="True"
                              IsTextSearchEnabled="False"/>
                </StackPanel>

                <!-- الصف الثاني -->
                <StackPanel Grid.Row="1" Grid.Column="0">
                    <TextBlock Text="الكمية"/>
                    <TextBox Height="30"
                             Text="{Binding InputQuantityText,
                                    UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <Button Grid.Row="1"
                        Grid.Column="4"
                        Content="➕ إضافة الصنف"
                        Height="40"
                        Margin="10,20,0,0"
                        Command="{Binding AddItemCommand}"
                        IsEnabled="{Binding ItemSelector.SelectedItemDescription}"/>
            </Grid>
        </GroupBox>

        <!-- ================= الأصناف ================= -->
        <DataGrid Grid.Row="2"
                  ItemsSource="{Binding Items}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  Margin="0,0,0,10">

            <DataGrid.Columns>
                <DataGridTextColumn Header="الصنف" ElementStyle="{StaticResource CenterCellText}" Binding="{Binding ItemName}" Width="*"/>
                <DataGridTextColumn Header="الوصف" ElementStyle="{StaticResource CenterCellText}" Binding="{Binding ItemCode}" Width="*"/>
                <DataGridTextColumn Header="الكمية" ElementStyle="{StaticResource CenterCellText}" Binding="{Binding Quantity}" Width="*"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- ================= حفظ ================= -->
        <Button Grid.Row="3"
                Content="💾 حفظ إذن الصرف"
                Height="45"
                FontSize="14"
                FontWeight="SemiBold"
                Command="{Binding SaveCommand}"/>
    </Grid>
</UserControl>
